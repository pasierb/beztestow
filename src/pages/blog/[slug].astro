---
import { getCollection, getEntry } from "astro:content";
import { readOne, readAll } from "../../lib/markdoc/read";
import { blog } from "../../lib/markdoc/frontmatter.schema";
import Renderer from "../../components/Renderer.astro";
import BlogPostMeta from "../../components/BlogPostMeta.astro";
import ContentLayout from "../../layouts/ContentLayout.astro";
import { SITE_URL } from "../../config";

export async function getStaticPaths() {
  const posts = await getCollection("blog");

  return posts.map((post) => {
    return { params: { slug: post.slug } };
  });
}

const { slug } = Astro.params;
if (typeof slug !== "string") {
  throw Error(`slug should be string. Received: ${slug}`);
}

const entry = await getEntry("blog", slug);
if (!entry) {
  throw new Error('');
}
const { Content } = await entry.render();
---

<ContentLayout title={entry.data.title} date={entry.data.date}>
  <BlogPostMeta
    title={entry.data.title}
    publishDate={entry.data.date.toISOString()}
    pagePath={`/blog/${slug}`}
    slot="meta"
  />

  <Content slot="content" />
</ContentLayout>
